## coding=utf-8

## Pages currently use v1 styling by default. Once the Pattern Library
## rollout has been completed, this default can be switched to v2.
<%! main_css = "style-main-v1" %>

## Standard imports
<%namespace name='static' file='/static_content.html'/>
<%!
from django.utils.translation import ugettext as _

from openedx.core.djangolib.js_utils import (
    dump_js_escaped_json, js_escaped_string
)
%>

<%page expression_filter="h"/>
<!doctype html>
<!--[if lte IE 9]><html class="ie9 lte9" lang="${LANGUAGE_CODE}"><![endif]-->
<!--[if !IE]><<!--><html lang="${LANGUAGE_CODE}"><!--<![endif]-->
  <head dir="${static.dir_rtl()}">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>
        <%block name="title"></%block> |
        % if context_course:
        <% ctx_loc = context_course.location %>
        ${context_course.display_name_with_default} |
        % elif context_library:
        ${context_library.display_name_with_default} |
        % endif
        ${settings.STUDIO_NAME}
    </title>

    <%include file="partials/analytics.html" />

    <%
      jsi18n_path = "js/i18n/{language}/djangojs.js".format(language=LANGUAGE_CODE)
    %>

    <script type="text/javascript" src="${static.url(jsi18n_path)}"></script>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="path_prefix" content="${EDX_ROOT_URL}">

    <!-- add favicon -->
    <link rel="icon" type="image/x-icon" href="${static.url('images/favicon.ico')}" />

    <%static:css group='style-vendor'/>
    <%static:css group='style-vendor-tinymce-content'/>
    <%static:css group='style-vendor-tinymce-skin'/>

    <%static:css group='${self.attr.main_css}'/>

    <%include file="/widgets/segment-io.html" />
    <%block name="header_extras"></%block>
    <link rel="stylesheet" type="text/css" href="${static.url('css/amc-specific.css')}">
  </head>

  <body class="${static.dir_rtl()} <%block name='bodyclass'></%block> lang_${LANGUAGE_CODE}">

    <% is_anonymous = user.is_anonymous() %>

    % if not is_anonymous:

        <% tier_has_expired = request.session.get('TIER_EXPIRED', False) %>
        <% tier_display_warning = request.session.get('DISPLAY_EXPIRATION_WARNING', False) %>
        <% tier_expires_in = request.session.get('TIER_EXPIRES_IN', False) %>

        % if tier_display_warning and tier_has_expired:
          <section class="amc--notification__area" style="background-color: #fff; padding: 1px 0;">
            <div class="amc--notification__content amc--notification--tier-expiration" style="width: 100%; max-width: 1280px; min-width: 900px; margin: 15px auto; background-color: #E4572E; box-shadow: 0 3px 8px 0 rgba(0,0,0,0.2); color: #fff; font-size: 14px; display: -ms-flexbox; display: flex; -ms-flex-align: center; align-items: center; padding: 20px 30px; border-radius: 30px;">
              <div class="amc--notification__text-left">
                Your Tahoe Trial <strong>has expired</strong>!
              </div>
              <div class="amc--notification__actions-right" style="margin-left: auto;">
                <a class="amc--notification--button secondary-action" href="https://www.appsembler.com/about/contact-us" target="_blank" style="padding: 7px 20px; margin: 5px; border-radius: 30px; text-decoration: none; background: none; border: 2px solid #fff; color: #fff; font-weight: bolder;">Contact us</a>
                <a class="amc--notification--button primary-action" href="https://amc-app.appsembler.com/app/buy-now" target="_blank" style="padding: 7px 20px; margin: 5px; border-radius: 30px; text-decoration: none; background-color: #fff; border: 2px solid #fff; color: #1a1a1a; font-weight: bolder;">Buy now!</a>
              </div>
            </div>
          </section>
        % elif tier_display_warning and tier_expires_in:
          <section class="amc--notification__area" style="background-color: #fff; padding: 1px 0;">
            <div class="amc--notification__content amc--notification--tier-expiration" style="width: 100%; max-width: 1280px; min-width: 900px; margin: 15px auto; background-color: #fff; box-shadow: 0 3px 8px 0 rgba(0,0,0,0.2); color: #1a1a1a; font-size: 14px; display: -ms-flexbox; display: flex; -ms-flex-align: center; align-items: center; padding: 20px 30px; border-radius: 30px;">
              <div class="amc--notification__text-left">
                Your Tahoe Trial <strong>expires</strong> in: <span class="expiration-info" style="font-size: 16px; font-weight: bolder;">${tier_expires_in}</span>
              </div>
              <div class="amc--notification__actions-right" style="margin-left: auto;">
                <a class="amc--notification--button secondary-action" href="https://www.appsembler.com/about/contact-us" target="_blank" style="padding: 7px 20px; margin: 5px; border-radius: 30px; text-decoration: none; background: none; border: 2px solid #0090c1; color: #0090c1; font-weight: bolder;">Contact us</a>
                <a class="amc--notification--button primary-action" href="https://amc-app.appsembler.com/app/buy-now" target="_blank" style="padding: 7px 20px; margin: 5px; border-radius: 30px; text-decoration: none; background-color: #0090c1; border: 2px solid #0090c1; color: #fff; font-weight: bolder;">Buy now!</a>
              </div>
            </div>
          </section>
        % endif

    % endif

    <%block name="view_notes"></%block>

    <a class="nav-skip" href="#main">${_("Skip to main content")}</a>

    <script type="text/javascript">
    window.baseUrl = '${settings.STATIC_URL | n, js_escaped_string}';
var require = {baseUrl: window.baseUrl};
</script>
    <script type="text/javascript" src="${static.url("common/js/vendor/require.js")}"></script>
    <script type="text/javascript" src="${static.url("cms/js/require-config.js")}"></script>

    <!-- view -->
    <div class="wrapper wrapper-view" dir="${static.dir_rtl()}">
        <% online_help_token = self.online_help_token() if hasattr(self, 'online_help_token') else None %>
        <%include file="/widgets/header.html" args="online_help_token=online_help_token" />

      <div id="page-alert">
      <%block name="page_alert"></%block>
      </div>

      <main id="main" aria-label="Content" tabindex="-1">
          <div id="content">
          <%block name="content"></%block>
          </div>
      </main>

      % if user.is_authenticated():
        <%include file="/widgets/sock.html" args="online_help_token=online_help_token" />
      % endif
      <%include file="/widgets/footer.html" />

      <div id="page-notification"></div>
    </div>

    <div id="page-prompt"></div>

    <%block name="modal_placeholder"></%block>

    <%block name="jsextra"></%block>
    <script type="text/javascript">
      require(['common/js/common_libraries'], function () {
          require(['js/factories/base'], function () {
              require(['js/models/course'], function(Course) {
                  % if context_course:
                      window.course = new Course({
                          id: "${context_course.id | n, js_escaped_string}",
                          name: "${context_course.display_name_with_default | n, js_escaped_string}",
                          url_name: "${context_course.location.name | n, js_escaped_string}",
                          org: "${context_course.location.org | n, js_escaped_string}",
                          num: "${context_course.location.course | n, js_escaped_string}",
                          display_course_number: "${context_course.display_coursenumber | n, js_escaped_string}",
                          revision: "${context_course.location.revision | n, js_escaped_string}",
                          self_paced: ${context_course.self_paced | n, dump_js_escaped_json}
                      });
                  % endif
                  % if user.is_authenticated():
                      require(['js/sock']);
                  % endif
                  <%block name='requirejs'></%block>
              });
          });
      });
    </script>
    <%include file="/widgets/segment-io-footer.html" />
    <div class="modal-cover"></div>
    <script>!function(e,o,n){window.HSCW=o,window.HS=n,n.beacon=n.beacon||{};var t=n.beacon;t.userConfig={},t.readyQueue=[],t.config=function(e){this.userConfig=e},t.ready=function(e){this.readyQueue.push(e)},o.config={docs:{enabled:!0,baseUrl:"//appsembler.helpscoutdocs.com/"},contact:{enabled:!0,formId:"fdef890f-fabb-11e5-a329-0ee2467769ff"}};var r=e.getElementsByTagName("script")[0],c=e.createElement("script");c.type="text/javascript",c.async=!0,c.src="https://djtflbt20bdde.cloudfront.net/",r.parentNode.insertBefore(c,r)}(document,window.HSCW||{},window.HS||{});</script>
      % if user.is_authenticated():
        <script>
          HS.beacon.ready(function() {
            HS.beacon.identify({
              %if user.get_full_name():
                name: '${user.get_full_name()}',
              %endif
              email: '${user.email}'
            });
          });
        </script>
      %endif
  </body>
</html>
