<%!
from django.utils.translation import ugettext as _
from django.core.urlresolvers import reverse
%>

<%page args="course_enrollments, template_settings" />

<%namespace file='/theme-variables.html' import="get_global_settings, get_dashboard_settings" />

<%
  if get_dashboard_settings()['promote_course_catalog']:
    dashboard_sidebar_enabled = True
  else:
    dashboard_sidebar_enabled = False
  endif
%>

% if message or enrollment_message:
  <section class="a--dashboard-01__notifications">
    <ul class="bs-container a--container a--dashboard-01__notifications__container">
      % if message:
        <li class="a--dashboard-01__notifications__notification">
          ${message}
        </li>
      % endif
      % if enrollment_message:
        <li class="a--dashboard-01__notifications__notification">
          ${enrollment_message}
        </li>
      % endif
    </ul>
  </section>
% endif

% if get_dashboard_settings()['dashboard_search_enabled']:
  <section class="a--dashboard-01__discovery bs-container a--container">
    <%include file = "/design-templates/live-blocks/discovery/_discovery-search-01.html" args='search_wrapper_id = "dashboard-search-bar"' />
    <script>
      $( "#discovery-message" ).append("${_("My Modules")}");
    </script>
  </section>
% endif

<section class="a--dashboard__content">
  <div class="bs-container a--container a--dashboard-01__main__container">
    <div class="a--dashboard-01__main__content">
      <div class="a--dashboard-01__main__courses-container" id="my-courses">
        % if len(course_enrollments) > 0:
          <ul class="a--dashboard-01__main__courses">
            % for dashboard_index, enrollment in enumerate(course_enrollments):
              <% show_courseware_link = (enrollment.course_id in show_courseware_links_for) %>
              <% cert_status = cert_statuses.get(enrollment.course_id) %>
              <% can_unenroll = (not cert_status) or cert_status.get('can_unenroll') %>
              <% credit_status = credit_statuses.get(enrollment.course_id) %>
              <% show_email_settings = (enrollment.course_id in show_email_settings_for) %>
              <% course_mode_info = all_course_modes.get(enrollment.course_id) %>
              <% show_refund_option = (enrollment.course_id in show_refund_option_for) %>
              <% is_paid_course = (enrollment.course_id in enrolled_courses_either_paid) %>
              <% is_course_blocked = (enrollment.course_id in block_courses) %>
              <% course_verification_status = verification_status_by_course.get(enrollment.course_id, {}) %>
              <% course_requirements = courses_requirements_not_met.get(enrollment.course_id) %>
              <% related_programs = programs_by_run.get(unicode(enrollment.course_id)) %>
              <%include file="/design-templates/${get_dashboard_settings()['dashboard_course_listing']}" args='course_overview=enrollment.course_overview, enrollment=enrollment, show_courseware_link=show_courseware_link, cert_status=cert_status, can_unenroll=can_unenroll, credit_status=credit_status, show_email_settings=show_email_settings, course_mode_info=course_mode_info, show_refund_option=show_refund_option, is_paid_course=is_paid_course, is_course_blocked=is_course_blocked, verification_status=course_verification_status, course_requirements=course_requirements, dashboard_index=dashboard_index, share_settings=share_settings, user=user, related_programs=related_programs, display_course_modes_on_dashboard=display_course_modes_on_dashboard' />
            % endfor
          </ul>
        % else:
          <div class="a--dashboard-01__main__no-enrollments__container">
            <p>${_("You are not enroled in any courses yet.")}</p>
            % if get_dashboard_settings()['promote_course_catalog']:
              <a class="a--dashboard-01__main__no-enrollments__cta" href="${marketing_link('COURSES')}">${_("Find Modules")}!</a>
            % endif
          </div>
        % endif
      </div>
      % if get_dashboard_settings()['dashboard_search_enabled']:
        <div class="a--dashboard-01__main__search-results" id="dashboard-search-results">
        </div>
      % endif
    </div>
    % if dashboard_sidebar_enabled:
      <aside class="a--dashboard-01__main__sidebar">
        % if get_dashboard_settings()['promote_course_catalog'] and get_global_settings().get('course-catalogue_enabled', True):
        <div class="a--dashboard-01__promote-catalog">
          <p>${_(get_dashboard_settings()['promote_course_catalog_text'])}</p>
          <a class="a--dashboard-01__promote-catalog__cta" href="${marketing_link('COURSES')}">${_("Find Modules")}!</a>
        </div>
        % endif
      </aside>
    % endif
  </div>
</section>


<section class="modal a--modal a--bottom-slideout-modal" id="email-settings-modal" tabindex="-1" aria-hidden="true">
  <div class="a--bottom-slideout-modal__wrapper" role="dialog">
    <div class="bs-container a--container a--bottom-slideout-modal__container">
      <h1 class="a--bottom-slideout-modal__title">
        ${_("Email Settings for {course_number}").format(course_number='<span id="email_settings_course_number"></span>')}
      </h1>
      <form id="email_settings_form" method="post">
        <div class="a--bottom-slideout-modal__content">
          <input name="course_id" id="email_settings_course_id" type="hidden" />
          <span>${_("Receive course emails")} <input type="checkbox" id="receive_emails" name="receive_emails" /></span>
        </div>
        <div class="a--bottom-slideout-modal__controls">
          <button type="submit" id="submit" class="a--bottom-slideout-modal__control-button action">${_("Save Settings")}</button>
          <button type="button" class="a--bottom-slideout-modal__control-button dismiss close-modal" data-dismiss="modal" aria-label="Cancel">${_("Close")}</button>
        </div>
      </form>
    </div>
  </div>
</section>

<section class="modal unenroll-modal a--modal a--bottom-slideout-modal" id="unenroll-modal" tabindex="-1" aria-hidden="true">
  <div class="a--bottom-slideout-modal__wrapper" role="dialog">
    <div class="bs-container a--container a--bottom-slideout-modal__container">
      <h1 class="a--bottom-slideout-modal__title">
        <span id='track-info'></span>
      </h1>
      <form id="unenroll_form" method="post" data-remote="true" action="${reverse('change_enrollment')}">
        <div class="a--bottom-slideout-modal__content">
          <span id='refund-info'></span>
          <input name="course_id" id="unenroll_course_id" type="hidden" />
          <input name="enrollment_action" type="hidden" value="unenroll" />
        </div>
        <div class="a--bottom-slideout-modal__controls">
          <button type="submit" name="submit" class="a--bottom-slideout-modal__control-button warning">${_("Unenrol")}</button>
          <button type="button" class="a--bottom-slideout-modal__control-button dismiss close-modal" data-dismiss="modal" aria-label="Cancel">${_("Close")}</button>
        </div>
      </form>
      <div id="unenroll_error" class="modal-form-error"></div>
    </div>
  </div>
</section>
